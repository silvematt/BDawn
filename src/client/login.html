<!DOCTYPE html>
<html>

<head>
    <title>BDawn - Web Client - Login</title>
    <script>
      function OnLogin() 
      {
          var request = new XMLHttpRequest();
          request.onreadystatechange = function() 
          {
              if (this.readyState == 4) 
              {
                  var res = JSON.parse(this.responseText);
                  
                  // Add to local storage
                  localStorage.setItem("bdawn_sess_tkn", res.rTkn);
                  
                  alert(localStorage.getItem("bdawn_sess_tkn"));
                  
                  const resLabel = document.getElementById('ResultLabel');

                  if(res.rMessage == "LOGIN_OK")
                  {
                    resLabel.textContent = "Logged in!";
                  }
                  else if(res.rMessage == "LOGIN_NOT_OK")
                  {
                    resLabel.textContent = "Invalid username or password.";
                  }
                  else
                  {
                    resLabel.textContent = "Error.";
                  }

              }
          };

          var formUser = document.getElementById("FORM_USERNAME").value;
          var formPassword = document.getElementById("FORM_PASSWORD").value;

          request.open('POST', 'http://localhost:3000/login');
          request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
          request.send(`user=${formUser}&password=${formPassword}`);
        }
    </script>
</head>

<body>

  
    <div class = "precont">
        <h1>BDawn - Web Client</h1>
        <h2>Login</h2>
    </div>

    <div class="container">
      <label for="uname"><b>Username: </b></label>
      <input ID = "FORM_USERNAME" type="text" placeholder="Enter Username" name="uname" required>
      <br/>
      <label for="psw"><b>Password:</b></label>
      <input id ="FORM_PASSWORD" type="password" placeholder="Enter Password" name="psw" required>
      <br/><br/>
      <button type="submit" onclick="OnLogin()">Login</button>
      <label>
        <input type="checkbox" checked="checked" name="remember"> Remember me
      </label>
    </div>
  
    <div class="container">
        <br/>
        <span class="psw">Forgot <a href="#">password?</a></span>
    </div>

    <label id="ResultLabel"><b></b></label>
</body>
</html>