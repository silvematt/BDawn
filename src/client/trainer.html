<!DOCTYPE html>
<html>

<head>
    <title>BDawn - Web Client - Trainer</title>
    <script>

        // Character's Stats
        var charStats;

      function OnTrainer() 
      {
        document.getElementById("PROCESSING_MESSAGE").textContent = "Loading...";

        var request = new XMLHttpRequest();
        request.onreadystatechange = function() 
        {
            if (this.readyState == 4) 
            {
                var res = JSON.parse(this.responseText);
                
                const resLabel = document.getElementById('ResultLabel');
                
                // Cover all cases
                switch(res.rMessage)
                {
                    case "TOKEN_INVALID":
                        alert("Session expired.");
                        location.href = "http://localhost:3000/cLogin";
                        break;

                    case "CHARACTER_NOT_CREATED":
                        location.href = "http://localhost:3000/cCharacterCreation";
                        break;

                    case "OVERVIEW_SUCESS":
                        // Take everything and fill the page
                        charStats = res.rContent[0];

                        document.getElementById("STATS_VIT_VALUE").textContent = res.rContent[0].characterVitality;
                        document.getElementById("STATS_VIT_VALUE").innerHTML += ` <button type="submit" onclick="TrainAttributeRequest(0)">+</button> `;

                        document.getElementById("STATS_STR_VALUE").textContent = res.rContent[0].characterStrength;
                        document.getElementById("STATS_STR_VALUE").innerHTML += ` <button type="submit" onclick="TrainAttributeRequest(1)">+</button> `;

                        document.getElementById("STATS_DEX_VALUE").textContent = res.rContent[0].characterDexterity;
                        document.getElementById("STATS_DEX_VALUE").innerHTML += ` <button type="submit" onclick="TrainAttributeRequest(2)">+</button> `;

                        document.getElementById("STATS_AGI_VALUE").textContent = res.rContent[0].characterAgility;
                        document.getElementById("STATS_AGI_VALUE").innerHTML += ` <button type="submit" onclick="TrainAttributeRequest(3)">+</button> `;

                        document.getElementById("STATS_INT_VALUE").textContent = res.rContent[0].characterIntelligence;
                        document.getElementById("STATS_INT_VALUE").innerHTML += ` <button type="submit" onclick="TrainAttributeRequest(4)">+</button> `;

                        document.getElementById("STATS_FAI_VALUE").textContent = res.rContent[0].characterFaith;
                        document.getElementById("STATS_FAI_VALUE").innerHTML += ` <button type="submit" onclick="TrainAttributeRequest(5)">+</button> `;

                        document.getElementById("INVENTORY_GOLDS_VALUE").textContent = res.rContent[0].inventoryGolds;

                        GetStatsInfoAndDisplayCosts();
                        break;

                    default:
                    alert("DEFAULT: Session expired.");
                        location.href = "http://localhost:3000/cLogin";
                        break;
                }
            }
        };

          var session = localStorage.getItem("bdawn_sess_tkn")
          request.open('POST', 'http://localhost:3000/overview');
          request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
          request.send(`tkn=${session}`);
        }

        window.onload = function()
        {
            OnTrainer();
        };

        function GetStatsInfoAndDisplayCosts()
        {
            document.getElementById("PROCESSING_MESSAGE").textContent = "Loading...";

            var request = new XMLHttpRequest();
            request.onreadystatechange = function() 
            {
                if (this.readyState == 4) 
                {
                    var res = JSON.parse(this.responseText);
                    
                    const resLabel = document.getElementById('ResultLabel');
                    
                    // Cover all cases
                    switch(res.rMessage)
                    {
                        case "OK":

                            // Take everything and fill the page
                            console.log(res.rContent[0].Cost);
                            document.getElementById("STATS_VIT_VALUE").innerHTML += ` <a>${res.rContent[0].Cost * charStats.characterVitality}</a> `;
                            document.getElementById("STATS_STR_VALUE").innerHTML += ` <a>${res.rContent[1].Cost * charStats.characterStrength}</a> `;
                            document.getElementById("STATS_DEX_VALUE").innerHTML += ` <a>${res.rContent[2].Cost * charStats.characterDexterity}</a> `;
                            document.getElementById("STATS_AGI_VALUE").innerHTML += ` <a>${res.rContent[3].Cost * charStats.characterAgility}</a> `;
                            document.getElementById("STATS_INT_VALUE").innerHTML += ` <a>${res.rContent[4].Cost * charStats.characterIntelligence}</a> `;
                            document.getElementById("STATS_FAI_VALUE").innerHTML += ` <a>${res.rContent[5].Cost * charStats.characterFaith}</a> `;

                            // READY
                            document.getElementById("PROCESSING_MESSAGE").textContent = "";
                            document.getElementById('fullbody').style.display = 'block';
                            break;

                        default:
                        alert("DEFAULT: Session expired.");
                            location.href = "http://localhost:3000/cLogin";
                            break;
                    }
                }
            };

          var session = localStorage.getItem("bdawn_sess_tkn")
          request.open('GET', 'http://localhost:3000/getStatsInfo');
          request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
          request.send();
        }

        function TrainAttributeRequest(attrID)
        {
            document.getElementById("PROCESSING_MESSAGE").textContent = "Loading...";

            var request = new XMLHttpRequest();
            request.onreadystatechange = function() 
            {
                if (this.readyState == 4) 
                {
                    var res = JSON.parse(this.responseText);
                    
                    const resLabel = document.getElementById('ResultLabel');
                    
                    // Cover all cases
                    switch(res.rMessage)
                    {
                        case "TOKEN_INVALID":
                            alert("Session expired.");
                            location.href = "http://localhost:3000/cLogin";
                            break;

                        case "TRAIN_ATTRIBUTE_SUCCESS":
                            // Take everything and fill the page
                            OnTrainer();

                            document.getElementById("ResultLabel").textContent = "Sucessfully trained!";
                            break;

                        case "TRAIN_ATTRIBUTE_FAILD_NOT_ENOUGH_GOLDS":GetStatsInfoAndDisplayCosts
                            document.getElementById("ResultLabel").textContent = "You don't have enough golds!";
                            document.getElementById("PROCESSING_MESSAGE").textContent = "";
                            break;

                        default:
                        alert("DEFAULT: Session expired.");
                            location.href = "http://localhost:3000/cLogin";
                            break;
                    }
                }
            };

            var session = localStorage.getItem("bdawn_sess_tkn")
            request.open('POST', 'http://localhost:3000/trainAttribute');
            request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            request.send(`tkn=${session}&attributeToTrain=${attrID}`);
        }
        
    </script>
</head>

<body>

  
    <div class = "precont">
        <h1>BDawn - Web Client</h1>
        <h2>Trainer</h2>
    </div>

    <label id="PROCESSING_MESSAGE"><b></b></label>


    <section class="fullbody">

        <div style="float: left;padding: 20px;">
        <fieldset>
            <h1>Navigation</h1>
            <span id="navbarcontent"></span>
            <script src = "http://localhost:3000/js/generatenavbar.js"></script>
        </fieldset>
        </div>

        <div>
            <fieldset style="width:40%">
                  <br>
    
                  <textarea rows="1" cols="30" readonly style="resize:none">Here you can train your skills.</textarea>
                 <br><br>
                 <div w3-include-html="content.html"></div>
    
                  <table style="width:100%; border: 1px solid black; border-radius: 10px;" >
                    <tr>
                      <td>Vitality</td>
                      <td>Strength</td>
                      <td>Dexterity</td>
                      <td>Agility</td>
                      <td>Intelligence</td>
                      <td>Faith</td>
                    </tr>
                    <tr>
                      <td id="STATS_VIT_VALUE">16</td>
                      <td id="STATS_STR_VALUE">14</td>
                      <td id="STATS_DEX_VALUE">10</td>
                      <td id="STATS_AGI_VALUE">10</td>
                      <td id="STATS_INT_VALUE">10</td>
                      <td id="STATS_FAI_VALUE">10</td>
                    </tr>
                  </table>
                  <br>
    
                  <br>
                  <label for="InventoryGoldsL">Golds: </label>
                  <b id = "INVENTORY_GOLDS_VALUE"></b>
                  <br><br>
    
                  <span>&nbsp</span>
                  <label id="ResultLabel"><b></b></label>
            </fieldset>
        </div>
    </section>
    

</body>
</html>